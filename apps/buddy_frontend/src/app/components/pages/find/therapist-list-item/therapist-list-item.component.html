<div
   *ngIf="getNextCallTime() as callTimeToRemind"
   @fade
   class="reminder-note-wrapper"
>
   <svg
      class="clock"
      [class.callable]="reminderIsNow()"
      width="48"
      height="48"
      version="1.1"
      viewBox="0 0 12.7 12.7"
      xmlns="http://www.w3.org/2000/svg"
   >
      <g transform="translate(.58229 .6424)">
         <path
            d="m6.5883 0.4372c-0.041832 0.018832-0.083193 0.039656-0.12362 0.063214-0.046378 0.026547-0.092678 0.054376-0.13842 0.084313-0.36426 0.24303-0.68901 0.62558-0.92632 1.1297-0.091406 0.19404 0.055097 0.41599 0.26944 0.40822 1.0036-0.036943 2.0187 0.12983 3.0514 0.49877 0.20293 0.072953 0.41063-0.096066 0.38045-0.30959-0.16579-1.1766-0.82106-1.9113-1.6119-2.0195-0.30277-0.041404-0.61018 0.0095377-0.90111 0.14468zm-5.1393 2.6726c-0.34252 0.1624-0.60395 0.41155-0.76037 0.72379-0.3575 0.71369-0.12951 1.6618 0.67178 2.4364 0.15414 0.14933 0.41169 0.082318 0.4735-0.1232 0.28884-0.96188 0.77396-1.8689 1.4564-2.7275 0.13393-0.16855 0.040949-0.41904-0.17049-0.45945-0.58357-0.11134-1.1019-0.071342-1.5191 0.085701-0.052118 0.019659-0.10273 0.041203-0.15178 0.064147zm3.2167-0.01809c-2.0428 1.0364-2.862 3.5302-1.8318 5.5761 0.53893 1.0702 1.5135 1.8558 2.6738 2.1552 0 0 1.2525 0.13522 1.0594 0.13168 0.64224-0.0031 1.275-0.15508 1.8486-0.44389 0.59458-0.29941 1.1086-0.73736 1.4986-1.2769l0.51008-0.94022c0.42206-1.0947 0.36183-2.3167-0.1658-3.3646-1.0324-2.0503-3.5313-2.8754-5.5816-1.8431-0.00381 0.00201-0.0076 0.00381-0.011483 0.00572zm0.51562 1.0001c0.00114-5.713e-4 0.00229-0.00116 0.00258-0.00116 0.26169-0.13155 0.58049-0.025976 0.71213 0.23566l1.1245 2.2333c0.16987 0.33736-0.057368 0.73913-0.434 0.76762l-1.3728 0.10317c-0.29248 0.022172-0.54745-0.19722-0.5692-0.48973-0.021857-0.29231 0.19749-0.54694 0.48981-0.56865l0.58216-0.043378-0.768-1.5252c-0.13144-0.26104-0.027229-0.57922 0.23328-0.71171z"
         />
      </g>
   </svg>
   <div class="free-from-wrapper">
      @if(reminderIsNow()) { Anrufbar! } @else { Nächste Erinnerung
      {{ callTimeToRemind.weekday }} {{ callTimeToRemind.from }}
      }
   </div>
</div>
<div class="main-wrapper">
   <div class="header-wrapper">
      <button class="name-wrapper" (click)="toggleExpansion()">
         {{ therapist.name }}
      </button>
      <div class="icon-wrapper">
         <a
            *ngIf="therapist.address"
            [href]="generateGoogleMapsLink()"
            target="_blank"
         >
            <svg
               width="11.112mm"
               height="11.112mm"
               version="1.1"
               viewBox="0 0 11.112 11.112"
               xmlns="http://www.w3.org/2000/svg"
            >
               <g transform="translate(-.11911 -.11911)">
                  <path
                     d="m5.7964 0.17209c-2.1816 0-3.9669 1.8383-3.9428 4.0805 0.011657 1.0837 0.54281 2.0417 1.1008 2.8433 0.55802 0.80153 1.1677 1.4877 1.3753 1.8609 0.26141 0.46999 0.36595 0.91576 0.49393 1.3122 0.063982 0.19824 0.12867 0.3906 0.27737 0.57759 0.14872 0.18699 0.42775 0.33338 0.69537 0.33338 0.28852 0 0.54921-0.1748 0.69345-0.36007 0.14424-0.1853 0.22616-0.38543 0.30505-0.59595 0.15779-0.42104 0.28931-0.89766 0.49522-1.2987 0.26924-0.52436 0.86073-1.1927 1.4023-1.9584 0.54157-0.76566 1.0471-1.6619 1.0471-2.7194 0-2.2364-1.7615-4.0754-3.9431-4.0754zm1.524e-4 2.6489c0.74152-6.6e-6 1.3507 0.62014 1.3507 1.4264 2.59e-5 0.80629-0.60916 1.4268-1.3507 1.4268-0.74152 1.33e-5 -1.3519-0.62055-1.3519-1.4268 0-0.80627 0.61041-1.4264 1.3519-1.4264z"
                     style="
                        color-rendering: auto;
                        color: #000000;
                        dominant-baseline: auto;
                        fill: #453913;
                        font-feature-settings: normal;
                        font-variant-alternates: normal;
                        font-variant-caps: normal;
                        font-variant-east-asian: normal;
                        font-variant-ligatures: normal;
                        font-variant-numeric: normal;
                        font-variant-position: normal;
                        font-variation-settings: normal;
                        image-rendering: auto;
                        inline-size: 0;
                        isolation: auto;
                        mix-blend-mode: normal;
                        shape-margin: 0;
                        shape-padding: 0;
                        shape-rendering: auto;
                        solid-color: #000000;
                        stop-color: #000000;
                        text-decoration-color: #000000;
                        text-decoration-line: none;
                        text-decoration-style: solid;
                        text-indent: 0;
                        text-orientation: mixed;
                        text-transform: none;
                        white-space: normal;
                     "
                  />
               </g>
            </svg>
         </a>

         <a *ngIf="therapist.email" [href]="'mailto:' + therapist.email">
            <svg
               width="11.112mm"
               height="11.112mm"
               version="1.1"
               viewBox="0 0 11.112 11.112"
               xmlns="http://www.w3.org/2000/svg"
            >
               <g transform="translate(-.11911 -.11911)">
                  <path
                     d="m2.077 2.7151 3.6074 2.2911 3.6688-2.3305c0.31567-0.18818 0.17324-0.30289-0.05424-0.32442h-6.8988c-0.50722-0.013265-0.69461 0.057459-0.32316 0.36376zm8.3926 0.89405-4.4133 2.8038c-0.22699 0.14438-0.51711 0.14438-0.74405 0l-4.5389-2.8827c-0.32727-0.16163-0.54751 0.02378-0.56237 0.19462v4.2053c0 0.76094 0.61257 1.3735 1.3735 1.3735h8.199c0.7609 0 1.3735-0.61256 1.3735-1.3735v-4.0525c-0.018669-0.41881-0.33984-0.48944-0.68735-0.26857z"
                     style="fill: #453913; stop-color: #000000"
                  />
               </g>
            </svg>
         </a>

         <a *ngIf="therapist.phone" [href]="'tel:' + therapist.phone">
            <svg
               width="11.112mm"
               height="11.112mm"
               version="1.1"
               viewBox="0 0 11.112 11.112"
               xmlns="http://www.w3.org/2000/svg"
            >
               <g transform="translate(-.11911 -.11911)">
                  <path
                     d="m3.2215 10.972c0.31443-0.041065 0.62885-0.13408 1.3489-0.39884 1.2295-0.45205 1.8397-0.80199 2.7929-1.6017 0.31222-0.26192 1.1576-1.0931 1.4486-1.4243 0.68155-0.7756 1.1613-1.4893 1.4552-2.165 0.18629-0.42821 0.55627-1.4574 0.64064-1.782 0.2263-0.87051 0.074169-1.6682-0.47743-2.5023-0.20851-0.31542-0.40376-0.50961-0.60891-0.60561-0.24789-0.116-0.65642-0.21322-0.96207-0.22895l-0.2679-0.013751-0.096252 0.10654c-0.052951 0.058551-0.1384 0.18333-0.18991 0.27718-0.58173 1.06-0.82013 1.48-0.92006 1.6209-0.26366 0.37189-0.32282 0.5594-0.23196 0.73511 0.06865 0.13277 0.31595 0.37878 0.65216 0.64879 0.35282 0.28335 0.65139 0.58751 0.67705 0.68977 0.028747 0.11458-0.070578 0.35324-0.32762 0.78708-0.66608 1.1242-1.2451 1.7861-2.1458 2.4531-0.31645 0.23432-1.1478 0.74341-1.3683 0.83796-0.3187 0.13661-0.45066 0.047345-1.0651-0.72014-0.34729-0.43384-0.53966-0.58798-0.73384-0.58798-0.13741 0-0.2545 0.055134-0.56983 0.26808-0.12494 0.084399-0.52784 0.31876-0.89532 0.52082-0.89919 0.49439-0.94183 0.52017-1.0352 0.62597-0.080248 0.090891-0.080982 0.094489-0.065745 0.32071 0.017422 0.25881 0.14196 0.77949 0.2323 0.97126 0.13253 0.28131 0.5173 0.59592 1.0507 0.85906 0.56977 0.28109 1.1079 0.38086 1.6629 0.30829z"
                     style="fill: #453913; stroke-width: 0.62222"
                  />
               </g>
            </svg>
         </a>
      </div>
   </div>
   <div class="body-overlay" #bodyOverlay @expanded *ngIf="expanded">
      <div class="body-wrapper" #bodyWrapper>
         <div *ngIf="therapist.callTimes?.length > 0" class="section">
            Anrufzeiten
            <div class="calltimes-wrapper">
               @for (calltime of therapist.callTimes; track $index) {
               <button
                  (click)="toggleCallTimeReminder($index)"
                  [ngClass]="{ selected: calltime.reminder }"
                  class="calltime"
               >
                  <span>
                     <b>
                        {{ calltime.weekday }}
                     </b>
                  </span>
                  <span> {{ calltime.from }} - {{ calltime.to }} </span>
               </button>
               }
            </div>
         </div>

         <div *ngIf="therapist.note" (click)="editNote()" class="section notes">
            {{ therapist.note }}
         </div>

         <div *ngIf="therapist.therapyTypes" class="section">
            Bereiche: {{ getTherapyTypes() }}
         </div>

         <div *ngIf="therapist.freeFrom" class="section">
            Platz frei
            <b>ab {{ therapist.freeFrom | date : 'dd. MMMM, yyyy' }}</b>
         </div>

         <div class="section describe-items-wrapper">
            @if(!editSectionOpen) {
            <button
               *ngIf="!therapist.note"
               (click)="editNote()"
               class="describe-item"
            >
               Notiz erstellen
            </button>
            <button
               *ngIf="!therapist.callTimes"
               (click)="editCallTimes()"
               class="describe-item"
            >
               Anrufzeit ergänzen
            </button>
            <button
               *ngIf="!therapist.phone"
               (click)="editPhone()"
               class="describe-item"
            >
               Telefonnummer angeben
            </button>
            <button
               *ngIf="!therapist.email"
               (click)="editMail()"
               class="describe-item"
            >
               Email angeben
            </button>
            <button
               *ngIf="!therapist.therapyTypes"
               (click)="editTherapyTypes()"
               class="describe-item"
            >
               Therapiearten angeben
            </button>
            <button
               *ngIf="!therapist.freeFrom"
               (click)="editFreeFrom()"
               class="describe-item"
            >
               'Frei ab' notieren
            </button>
            <button
               *ngIf="!therapist.address"
               (click)="editAddress()"
               class="describe-item"
            >
               Addresse ergänzen
            </button>
            <button class="describe-item" (click)="addAppointment()">
               Ich habe einen Termin
            </button>
            } @else {
            <button (click)="editName()" class="describe-item">
               Name ändern
            </button>
            <button
               *ngIf="therapist.callTimes"
               (click)="editCallTimes()"
               class="describe-item"
            >
               Anrufzeiten ändern
            </button>
            <button
               *ngIf="therapist.freeFrom"
               (click)="editFreeFrom()"
               class="describe-item"
            >
               Platz frei ab ändern
            </button>
            <button
               *ngIf="therapist.note"
               (click)="editNote()"
               class="describe-item"
            >
               Notiz bearbeiten
            </button>
            <button
               *ngIf="therapist.phone"
               (click)="editPhone()"
               class="describe-item"
            >
               Telefonnummer ändern
            </button>
            <button
               *ngIf="therapist.email"
               (click)="editMail()"
               class="describe-item"
            >
               Email ändern
            </button>
            <button
               *ngIf="therapist.address"
               (click)="editAddress()"
               class="describe-item"
            >
               Adresse ändern
            </button>
            <button
               class="describe-item"
               *ngIf="therapist.therapyTypes"
               (click)="editTherapyTypes()"
            >
               Therapiearten bearbeiten
            </button>
            <button class="describe-item delete" (click)="deleteTherapist()">
               Therapeut*in entfernen
            </button>
            }

            <button
               class="describe-item expand"
               (click)="toggleEditSectionOpen()"
            >
               weitere...
            </button>
         </div>
         @if(!!generateAddressFooter() || !!generateContactFooter()) {
         <div class="section footer">
            <div *ngIf="!!generateAddressFooter()">
               {{ generateAddressFooter() }}
            </div>
            <div *ngIf="!!generateContactFooter()">
               {{ generateContactFooter() }}
            </div>
         </div>
         }
      </div>
   </div>
</div>
